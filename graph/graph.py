"""
Graph Class - Instructor-provided infrastructure

DO NOT EDIT THIS FILE
Students should use this class but not modify it.

This module provides a simple Graph class supporting both directed/undirected
and weighted/unweighted graphs.
"""

from typing import List, Set, Dict, Tuple, Optional


class Graph:
    """
    A Graph class supporting directed/undirected and weighted/unweighted graphs.
    
    The graph is represented using an adjacency list structure.
    
    Attributes:
        directed (bool): Whether the graph is directed
        weighted (bool): Whether the graph has edge weights
    """
    
    def __init__(self, directed: bool = False, weighted: bool = False):
        """
        Initialize a new graph.
        
        Args:
            directed: If True, edges are directional
            weighted: If True, edges have weights
        """
        self.directed = directed
        self.weighted = weighted
        self._adjacency: Dict[str, Dict[str, float]] = {}
        self.blue: Set[str] = set()  # Set of blue vertices (for Task 1)
    
    def add_vertex(self, vertex: str) -> None:
        """
        Add a vertex to the graph.
        
        Args:
            vertex: The vertex identifier
        """
        if vertex not in self._adjacency:
            self._adjacency[vertex] = {}
    
    def add_edge(self, u: str, v: str, weight: float = 1.0) -> None:
        """
        Add an edge to the graph.
        
        Args:
            u: Source vertex
            v: Destination vertex
            weight: Edge weight (default 1.0)
        """
        # Ensure both vertices exist
        self.add_vertex(u)
        self.add_vertex(v)
        
        # Add edge from u to v
        self._adjacency[u][v] = weight
        
        # If undirected, also add edge from v to u
        if not self.directed:
            self._adjacency[v][u] = weight
    
    def vertices(self) -> List[str]:
        """
        Get all vertices in the graph.
        
        Returns:
            List of vertex identifiers
        """
        return list(self._adjacency.keys())
    
    def neighbors(self, vertex: str) -> List[str]:
        """
        Get all neighbors of a vertex.
        
        Args:
            vertex: The vertex to query
            
        Returns:
            List of neighboring vertex identifiers
            
        Raises:
            KeyError: If vertex does not exist in graph
        """
        if vertex not in self._adjacency:
            raise KeyError(f"Vertex {vertex} not found in graph")
        return list(self._adjacency[vertex].keys())
    
    def edges(self) -> List[Tuple[str, str, float]]:
        """
        Get all edges in the graph.
        
        Returns:
            List of tuples (u, v, weight) representing edges.
            For undirected graphs, each edge appears only once.
        """
        edges = []
        seen = set()
        
        for u in self._adjacency:
            for v, weight in self._adjacency[u].items():
                if self.directed:
                    edges.append((u, v, weight))
                else:
                    # For undirected, only add each edge once
                    edge_id = tuple(sorted([u, v]))
                    if edge_id not in seen:
                        edges.append((u, v, weight))
                        seen.add(edge_id)
        
        return edges
    
    def weight(self, u: str, v: str) -> float:
        """
        Get the weight of an edge.
        
        Args:
            u: Source vertex
            v: Destination vertex
            
        Returns:
            The edge weight
            
        Raises:
            KeyError: If the edge does not exist
        """
        if u not in self._adjacency:
            raise KeyError(f"Vertex {u} not found in graph")
        if v not in self._adjacency[u]:
            raise KeyError(f"Edge ({u}, {v}) not found in graph")
        return self._adjacency[u][v]
    
    def has_edge(self, u: str, v: str) -> bool:
        """
        Check if an edge exists.
        
        Args:
            u: Source vertex
            v: Destination vertex
            
        Returns:
            True if edge exists, False otherwise
        """
        return u in self._adjacency and v in self._adjacency[u]
    
    def vertex_count(self) -> int:
        """
        Get the number of vertices.
        
        Returns:
            Number of vertices in graph
        """
        return len(self._adjacency)
    
    def edge_count(self) -> int:
        """
        Get the number of edges.
        
        Returns:
            Number of edges in graph
        """
        return len(self.edges())
    
    def __repr__(self) -> str:
        """String representation of the graph."""
        graph_type = "Directed" if self.directed else "Undirected"
        weight_type = "Weighted" if self.weighted else "Unweighted"
        return f"{graph_type} {weight_type} Graph with {self.vertex_count()} vertices and {self.edge_count()} edges"
